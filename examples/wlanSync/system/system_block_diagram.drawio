<mxfile host="app.diagrams.net" type="device">
  <diagram name="System Block Diagram" id="sys-block-wlansync">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="&lt;b style='font-size:16px;'&gt;wlanSync - System Block Diagram&lt;/b&gt;&lt;br&gt;5-module WLAN synchronization pipeline (v5.0.2)" style="text;html=1;align=left;verticalAlign=top;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="340" y="20" width="500" height="40" as="geometry" />
        </mxCell>

        <!-- Data Input Port -->
        <mxCell id="io_data_in" value="&lt;b&gt;data_in&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;complex_t&lt;br&gt;26155 samples&lt;/font&gt;" style="shape=ellipse;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#059669;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="30" y="310" width="110" height="60" as="geometry" />
        </mxCell>

        <!-- M0: Prefilter -->
        <mxCell id="m0_box" value="&lt;b&gt;M0: Prefilter&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:10px'&gt;module0_prefilter&lt;/font&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;51-tap symmetric pre-add FIR&lt;br&gt;CSR=1.0 | II=1&lt;br&gt;&lt;font color='#6b7280'&gt;FP-SYMCOEFF, FP-PRAGMA&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#a5d8ff;strokeColor=#1971c2;fontSize=11;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="180" y="290" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- M1: Packet Detect -->
        <mxCell id="m1_box" value="&lt;b&gt;M1: Packet Detect&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:10px'&gt;module1_packet_detect&lt;/font&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;L-STF detection + write-through&lt;br&gt;ALL samples + startOffset&lt;br&gt;CSR=1.0 | II=1&lt;br&gt;&lt;font color='#6b7280'&gt;FP-DETECTION, FP-NOBREAK&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#a5d8ff;strokeColor=#1971c2;fontSize=11;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="420" y="280" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- data_duplicator (splitter diamond) -->
        <mxCell id="data_dup" value="&lt;b&gt;DATA&lt;br&gt;DUP&lt;/b&gt;" style="shape=rhombus;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;fontSize=9;fontStyle=0;" vertex="1" parent="1">
          <mxGeometry x="670" y="315" width="60" height="50" as="geometry" />
        </mxCell>

        <!-- startOffset_duplicator (splitter diamond) -->
        <mxCell id="offset_dup" value="&lt;b&gt;SPLIT&lt;br&gt;startOff&lt;/b&gt;" style="shape=rhombus;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;fontSize=8;fontStyle=0;" vertex="1" parent="1">
          <mxGeometry x="670" y="500" width="60" height="50" as="geometry" />
        </mxCell>

        <!-- M2: Coarse CFO -->
        <mxCell id="m2_box" value="&lt;b&gt;M2: Coarse CFO&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:10px'&gt;module2_coarse_cfo&lt;/font&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;Coarse CFO estimation + correction&lt;br&gt;FSM + circ_buf[2048] + DATAFLOW&lt;br&gt;CSR=4.0&lt;br&gt;&lt;font color='#6b7280'&gt;FP-ASYNC, FP-SEPARATION&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#a5d8ff;strokeColor=#1971c2;fontSize=11;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="790" y="190" width="210" height="120" as="geometry" />
        </mxCell>

        <!-- M3: Fine Sync -->
        <mxCell id="m3_box" value="&lt;b&gt;M3: Fine Sync&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:10px'&gt;module3_fine_sync&lt;/font&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;Fine timing L-LTF cross-corr&lt;br&gt;3x hls::FIR IP, SP=16, Karatsuba&lt;br&gt;CSR=1.0&lt;br&gt;&lt;font color='#6b7280'&gt;FP-CORR, FP-CORR-SP&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#a5d8ff;strokeColor=#1971c2;fontSize=11;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="1060" y="190" width="210" height="120" as="geometry" />
        </mxCell>

        <!-- fineOffset_duplicator -->
        <mxCell id="fine_dup" value="&lt;b&gt;SPLIT&lt;br&gt;fineOff&lt;/b&gt;" style="shape=rhombus;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;fontSize=8;fontStyle=0;" vertex="1" parent="1">
          <mxGeometry x="1280" y="350" width="60" height="50" as="geometry" />
        </mxCell>

        <!-- M4: Fine CFO Apply -->
        <mxCell id="m4_box" value="&lt;b&gt;M4: Fine CFO Apply&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:10px'&gt;module4_fine_cfo_apply&lt;/font&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;Fine CFO estimation + correction&lt;br&gt;Dual-async FSM + circ_buf[8192]&lt;br&gt;CSR=162.7&lt;br&gt;&lt;font color='#6b7280'&gt;FP-ASYNC, FP-SEPARATION&lt;/font&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#a5d8ff;strokeColor=#1971c2;fontSize=11;arcSize=12;" vertex="1" parent="1">
          <mxGeometry x="1060" y="430" width="210" height="120" as="geometry" />
        </mxCell>

        <!-- Data Output Port -->
        <mxCell id="io_data_out" value="&lt;b&gt;data_out&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;complex_t&lt;br&gt;26030 samples&lt;/font&gt;" style="shape=ellipse;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#059669;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1380" y="460" width="110" height="60" as="geometry" />
        </mxCell>

        <!-- Control Output: coarseFreqOff -->
        <mxCell id="io_coarse_freq" value="&lt;b&gt;coarseFreqOff&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;freq_t&lt;/font&gt;" style="shape=ellipse;whiteSpace=wrap;html=1;fillColor=#fce7f3;strokeColor=#db2777;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1380" y="100" width="110" height="50" as="geometry" />
        </mxCell>

        <!-- Control Output: fineFreqOff -->
        <mxCell id="io_fine_freq" value="&lt;b&gt;fineFreqOff&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;freq_t&lt;/font&gt;" style="shape=ellipse;whiteSpace=wrap;html=1;fillColor=#fce7f3;strokeColor=#db2777;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1380" y="570" width="110" height="50" as="geometry" />
        </mxCell>

        <!-- Control Output: fineOffset -->
        <mxCell id="io_fine_offset" value="&lt;b&gt;fineOffset&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;index_t&lt;/font&gt;" style="shape=ellipse;whiteSpace=wrap;html=1;fillColor=#fce7f3;strokeColor=#db2777;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1380" y="300" width="110" height="50" as="geometry" />
        </mxCell>

        <!-- === DATA ARROWS (solid blue) === -->

        <!-- INPUT -> M0 -->
        <mxCell id="arrow_in_m0" value="26155" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="io_data_in" target="m0_box" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- M0 -> M1 -->
        <mxCell id="arrow_m0_m1" value="26105 (d=64)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="m0_box" target="m1_box" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- M1 -> data_duplicator -->
        <mxCell id="arrow_m1_datadup" value="26105" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="m1_box" target="data_dup" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- data_duplicator -> M2 -->
        <mxCell id="arrow_dup_m2" value="26105 (d=2)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="data_dup" target="m2_box" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="760" y="250" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- data_duplicator -> M4 -->
        <mxCell id="arrow_dup_m4" value="26105 (d=2)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="data_dup" target="m4_box" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="760" y="490" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- M2 -> M3 -->
        <mxCell id="arrow_m2_m3" value="640 (d=680)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="m2_box" target="m3_box" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- M4 -> data_out -->
        <mxCell id="arrow_m4_out" value="26030 (d=128)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="m4_box" target="io_data_out" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- === CONTROL ARROWS (dashed red) === -->

        <!-- M1 -> startOffset_duplicator -->
        <mxCell id="arrow_m1_offsetdup" value="startOffset" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="m1_box" target="offset_dup" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="520" y="525" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- startOffset_dup -> M2 -->
        <mxCell id="arrow_off_m2" value="to M2 (d=2)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="offset_dup" target="m2_box" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="770" y="525" />
              <mxPoint x="770" y="310" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- startOffset_dup -> M4 -->
        <mxCell id="arrow_off_m4" value="to M4 (d=2)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="offset_dup" target="m4_box" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="700" y="570" />
              <mxPoint x="1040" y="570" />
              <mxPoint x="1040" y="550" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- M2 -> coarseFreqOff output -->
        <mxCell id="arrow_m2_freq" value="coarseFreqOff" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="m2_box" target="io_coarse_freq" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="895" y="125" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- M3 -> fineOffset_duplicator -->
        <mxCell id="arrow_m3_finedup" value="fineOffset" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="m3_box" target="fine_dup" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1310" y="310" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- fineOffset_dup -> M4 -->
        <mxCell id="arrow_fine_m4" value="to M4" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fine_dup" target="m4_box" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1310" y="430" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- fineOffset_dup -> fineOffset output -->
        <mxCell id="arrow_fine_out" value="fineOffset" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fine_dup" target="io_fine_offset" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- M4 -> fineFreqOff output -->
        <mxCell id="arrow_m4_finefreq" value="fineFreqOff" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="m4_box" target="io_fine_freq" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1165" y="595" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- === LEGEND === -->
        <mxCell id="legend_box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f9fafb;strokeColor=#d1d5db;dashed=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="30" y="80" width="280" height="170" as="geometry" />
        </mxCell>
        <mxCell id="legend_title" value="&lt;b&gt;Legend&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=top;fontSize=12;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="85" width="80" height="20" as="geometry" />
        </mxCell>

        <!-- Legend: data arrow -->
        <mxCell id="legend_data_line" value="" style="endArrow=block;endFill=1;strokeColor=#1971c2;strokeWidth=2;html=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="45" y="120" as="sourcePoint" />
            <mxPoint x="105" y="120" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend_data_text" value="Data stream (hls::stream, N samples)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="115" y="112" width="190" height="18" as="geometry" />
        </mxCell>

        <!-- Legend: control arrow -->
        <mxCell id="legend_ctrl_line" value="" style="endArrow=block;endFill=1;strokeColor=#e03131;strokeWidth=1;dashed=1;html=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="45" y="145" as="sourcePoint" />
            <mxPoint x="105" y="145" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend_ctrl_text" value="Control signal (async, d=FIFO depth)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="115" y="137" width="190" height="18" as="geometry" />
        </mxCell>

        <!-- Legend: module box -->
        <mxCell id="legend_mod_box" value="M#" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#a5d8ff;strokeColor=#1971c2;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="45" y="165" width="55" height="22" as="geometry" />
        </mxCell>
        <mxCell id="legend_mod_text" value="Processing module" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="115" y="165" width="140" height="18" as="geometry" />
        </mxCell>

        <!-- Legend: splitter -->
        <mxCell id="legend_split_box" value="S" style="shape=rhombus;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;fontSize=9;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="55" y="193" width="28" height="22" as="geometry" />
        </mxCell>
        <mxCell id="legend_split_text" value="Inline duplicator (FP-SPLIT)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="115" y="192" width="170" height="18" as="geometry" />
        </mxCell>

        <!-- Legend: IO port -->
        <mxCell id="legend_io_box" value="I/O" style="shape=ellipse;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#059669;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="45" y="220" width="55" height="22" as="geometry" />
        </mxCell>
        <mxCell id="legend_io_text" value="Data port (green) / Ctrl port (pink)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="115" y="220" width="180" height="18" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
