<mxfile host="app.diagrams.net" type="device">
  <diagram name="M0 Architecture" id="m0-arch">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="800">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="&lt;b style='font-size:15px;'&gt;module0_prefilter - Architecture Overview&lt;/b&gt;&lt;br&gt;51-tap Symmetric Pre-Add FIR Filter, II=1, Case A (dense, no FSM)" style="text;html=1;align=left;verticalAlign=top;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="20" y="15" width="550" height="40" as="geometry" />
        </mxCell>

        <!-- Input Port -->
        <mxCell id="port_data_in" value="&lt;b&gt;data_in&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;hls::stream&amp;lt;complex_t&amp;gt;&lt;br&gt;26155 samples&lt;/font&gt;" style="shape=ellipse;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#059669;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="30" y="240" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- Main Processing Block -->
        <mxCell id="core_border" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8fafc;strokeColor=#94a3b8;dashed=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="210" y="90" width="680" height="430" as="geometry" />
        </mxCell>
        <mxCell id="core_label" value="&lt;b&gt;module0_prefilter&lt;/b&gt; - #pragma HLS PIPELINE II=1" style="text;html=1;align=left;verticalAlign=top;fontSize=12;fontColor=#94a3b8;" vertex="1" parent="1">
          <mxGeometry x="220" y="95" width="400" height="25" as="geometry" />
        </mxCell>

        <!-- Shift Registers -->
        <mxCell id="sr_re" value="&lt;b&gt;shift_reg_re[51]&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;ARRAY_PARTITION complete&lt;br&gt;51 x ap_fixed&amp;lt;16,4&amp;gt;&lt;br&gt;51 FFs (real channel)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#e0e7ff;strokeColor=#4f46e5;fontSize=10;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="240" y="140" width="170" height="90" as="geometry" />
        </mxCell>

        <mxCell id="sr_im" value="&lt;b&gt;shift_reg_im[51]&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;ARRAY_PARTITION complete&lt;br&gt;51 x ap_fixed&amp;lt;16,4&amp;gt;&lt;br&gt;51 FFs (imag channel)&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#e0e7ff;strokeColor=#4f46e5;fontSize=10;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="240" y="320" width="170" height="90" as="geometry" />
        </mxCell>

        <!-- Symmetric Pre-Add -->
        <mxCell id="preadd_block" value="&lt;b&gt;PRE-ADD&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;Symmetric optimization:&lt;br&gt;sr[k] + sr[50-k]&lt;br&gt;k = 0..24 (25 pairs)&lt;br&gt;+ center tap sr[25]&lt;br&gt;= 26 unique sums (17b)&lt;br&gt;&lt;b&gt;Halves DSP usage&lt;/b&gt;&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=10;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="460" y="140" width="160" height="140" as="geometry" />
        </mxCell>

        <mxCell id="preadd_block_im" value="&lt;b&gt;PRE-ADD (Q)&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;Same symmetric pairs&lt;br&gt;for imag channel&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=10;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="460" y="330" width="160" height="70" as="geometry" />
        </mxCell>

        <!-- Coefficient ROM -->
        <mxCell id="coeff_rom" value="&lt;b&gt;COEFFS[26]&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;26 unique symmetric coefficients&lt;br&gt;from filter_coeffs.txt&lt;br&gt;const ROM (coeff_t)&lt;br&gt;h[k] == h[50-k]&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#e0e7ff;strokeColor=#4f46e5;fontSize=10;arcSize=6;" vertex="1" parent="1">
          <mxGeometry x="680" y="100" width="180" height="90" as="geometry" />
        </mxCell>

        <!-- DSP Multiply -->
        <mxCell id="dsp_mul" value="&lt;b&gt;DSP48E1 MUL x26&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;26 multiplies per channel&lt;br&gt;(preadd * coeff)&lt;br&gt;18b x 16b = 34b product&lt;br&gt;&lt;b&gt;42 DSP total (CSYNTH)&lt;/b&gt;&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="680" y="220" width="180" height="100" as="geometry" />
        </mxCell>

        <!-- Accumulator -->
        <mxCell id="acc_block" value="&lt;b&gt;ACCUMULATE&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;26-term adder tree&lt;br&gt;accum_t: ap_fixed&amp;lt;36,12&amp;gt;&lt;br&gt;5-level reduction tree&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99e9f2;strokeColor=#0c8599;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="680" y="350" width="180" height="80" as="geometry" />
        </mxCell>

        <!-- Truncation -->
        <mxCell id="trunc_block" value="&lt;b&gt;TRUNCATE&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;accum_t (36b) -&gt; data_t (16b)&lt;br&gt;saturate + round&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="710" y="460" width="150" height="50" as="geometry" />
        </mxCell>

        <!-- Output Port -->
        <mxCell id="port_data_out" value="&lt;b&gt;data_out&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;hls::stream&amp;lt;complex_t&amp;gt;&lt;br&gt;26105 samples&lt;/font&gt;" style="shape=ellipse;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#059669;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="950" y="440" width="130" height="70" as="geometry" />
        </mxCell>

        <!-- === DATA ARROWS === -->

        <!-- data_in -> shift regs -->
        <mxCell id="arrow_in_sr_re" value="I channel" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="port_data_in" target="sr_re" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="180" y="185" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="arrow_in_sr_im" value="Q channel" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="port_data_in" target="sr_im" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="180" y="365" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- sr -> preadd -->
        <mxCell id="arrow_sr_preadd" value="16b pairs" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="sr_re" target="preadd_block" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow_sr_preadd_im" value="16b pairs" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="sr_im" target="preadd_block_im" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- preadd -> DSP mul -->
        <mxCell id="arrow_preadd_mul" value="17b" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="preadd_block" target="dsp_mul" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="arrow_preadd_mul_im" value="17b" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="preadd_block_im" target="dsp_mul" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="650" y="365" />
              <mxPoint x="650" y="270" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- coeff -> DSP mul -->
        <mxCell id="arrow_coeff_mul" value="coeff_t" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#4f46e5;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#4f46e5;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="coeff_rom" target="dsp_mul" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- DSP mul -> accumulate -->
        <mxCell id="arrow_mul_acc" value="34b product" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="dsp_mul" target="acc_block" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- accumulate -> truncate -->
        <mxCell id="arrow_acc_trunc" value="36b" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="acc_block" target="trunc_block" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- truncate -> data_out -->
        <mxCell id="arrow_trunc_out" value="16b" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="trunc_block" target="port_data_out" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- === ANNOTATION === -->
        <mxCell id="sym_note" value="&lt;font color='#059669'&gt;&lt;b&gt;FP-SYMCOEFF:&lt;/b&gt; h[k]==h[50-k] symmetry exploited.&lt;br&gt;25 symmetric pairs + 1 center tap = 26 unique coefficients.&lt;br&gt;Pre-add halves DSP: 26 DSP/channel instead of 51.&lt;/font&gt;" style="text;html=1;align=left;verticalAlign=top;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="30" y="550" width="420" height="50" as="geometry" />
        </mxCell>

        <!-- === LEGEND === -->
        <mxCell id="legend_box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f9fafb;strokeColor=#d1d5db;dashed=0;" vertex="1" parent="1">
          <mxGeometry x="950" y="100" width="220" height="180" as="geometry" />
        </mxCell>
        <mxCell id="legend_title" value="&lt;b&gt;Legend&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=top;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="960" y="105" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend_dsp_box" value="DSP" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="960" y="130" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend_dsp_text" value="Compute / DSP48E1" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1020" y="130" width="140" height="18" as="geometry" />
        </mxCell>
        <mxCell id="legend_mem_box" value="MEM" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#e0e7ff;strokeColor=#4f46e5;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="960" y="155" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend_mem_text" value="Memory / ROM / Shift Reg" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1020" y="155" width="140" height="18" as="geometry" />
        </mxCell>
        <mxCell id="legend_acc_box" value="ACC" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99e9f2;strokeColor=#0c8599;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="960" y="180" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend_acc_text" value="Accumulator / Reduction" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1020" y="180" width="140" height="18" as="geometry" />
        </mxCell>
        <mxCell id="legend_trunc_box" value="TRUNC" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="960" y="205" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend_trunc_text" value="Truncation / Pipeline Reg" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1020" y="205" width="140" height="18" as="geometry" />
        </mxCell>
        <mxCell id="legend_io_box" value="I/O" style="shape=ellipse;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#059669;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="960" y="230" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend_io_text" value="Stream port (hls::stream)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1020" y="230" width="140" height="18" as="geometry" />
        </mxCell>
        <mxCell id="legend_memline" value="" style="endArrow=block;endFill=1;strokeColor=#4f46e5;strokeWidth=1;dashed=1;html=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="960" y="260" as="sourcePoint" />
            <mxPoint x="1010" y="260" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend_memline_text" value="Memory read (ROM)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1020" y="252" width="140" height="18" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
