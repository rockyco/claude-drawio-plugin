<mxfile host="app.diagrams.net" type="device">
  <diagram name="M2 Micro-Architecture" id="m2-microarch">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="0" pageScale="1" pageWidth="1600" pageHeight="1200">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="&lt;b&gt;module2_coarse_cfo - RTL Micro-Architecture&lt;/b&gt;&lt;br&gt;3-Stage DATAFLOW: EXTRACT(FSM+circ_buf) -&gt; COMPUTE(autocorr+CORDIC) -&gt; APPLY(NCO+rotation)" style="text;html=1;align=left;verticalAlign=top;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="20" y="10" width="750" height="40" as="geometry" />
        </mxCell>

        <!-- External I/O Ports -->
        <mxCell id="io-data-in" value="&lt;b&gt;data_in&lt;/b&gt;&lt;br&gt;complex_t" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#059669;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="20" y="220" width="90" height="50" as="geometry" />
        </mxCell>

        <mxCell id="io-ctrl-in" value="&lt;b&gt;startOffset_in&lt;/b&gt;&lt;br&gt;index_t (async)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#fce7f3;strokeColor=#db2777;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="20" y="120" width="90" height="50" as="geometry" />
        </mxCell>

        <mxCell id="io-data-out" value="&lt;b&gt;search_buffer_out&lt;/b&gt;&lt;br&gt;complex_t&lt;br&gt;640 samples" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#059669;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1360" y="310" width="110" height="60" as="geometry" />
        </mxCell>

        <mxCell id="io-freq-out" value="&lt;b&gt;coarseFreqOff_out&lt;/b&gt;&lt;br&gt;freq_t" style="ellipse;whiteSpace=wrap;html=1;fillColor=#fce7f3;strokeColor=#db2777;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1360" y="120" width="110" height="50" as="geometry" />
        </mxCell>

        <!-- ==================== EXTRACT Stage ==================== -->
        <mxCell id="stage-extract-border" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8fafc;strokeColor=#94a3b8;dashed=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="130" y="70" width="330" height="430" as="geometry" />
        </mxCell>
        <mxCell id="stage-extract-label" value="&lt;b&gt;EXTRACT&lt;/b&gt; (II=1)" style="text;html=1;align=center;verticalAlign=top;fontSize=12;fontColor=#94a3b8;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="240" y="75" width="110" height="20" as="geometry" />
        </mxCell>

        <!-- FSM Controller -->
        <mxCell id="extract-fsm" value="&lt;b&gt;FSM Controller&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px;'&gt;enum State:&lt;br&gt;WAIT_CTRL&lt;br&gt;WAIT_DATA_READY&lt;br&gt;EXTRACT_STATE&lt;br&gt;DONE&lt;/font&gt;&lt;br&gt;&lt;font style='font-size:8px;color:#6b7280;'&gt;switch(state) dispatch&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3c7;strokeColor=#d97706;fontSize=10;arcSize=8;verticalAlign=top;spacingTop=3;" vertex="1" parent="1">
          <mxGeometry x="150" y="110" width="140" height="130" as="geometry" />
        </mxCell>

        <!-- circ_buf BRAM -->
        <mxCell id="extract-circbuf" value="&lt;b&gt;circ_buf[2048]&lt;/b&gt;&lt;br&gt;complex_t&lt;br&gt;&lt;font style='font-size:9px;color:#6b7280;'&gt;BRAM (auto-inferred)&lt;br&gt;write_idx &amp;amp; 0x7FF&lt;br&gt;~4 RAMB18&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#e0e7ff;strokeColor=#4f46e5;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="320" y="110" width="120" height="90" as="geometry" />
        </mxCell>

        <!-- Write index register -->
        <mxCell id="extract-wr-idx" value="&lt;b&gt;write_idx&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px;'&gt;n counter&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="150" y="260" width="80" height="40" as="geometry" />
        </mxCell>

        <!-- Read index register -->
        <mxCell id="extract-rd-idx" value="&lt;b&gt;read_idx&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px;'&gt;replay offset&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="260" y="260" width="80" height="40" as="geometry" />
        </mxCell>

        <!-- Extract count -->
        <mxCell id="extract-count" value="&lt;b&gt;extract_count&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px;'&gt;0..SEARCH_LEN&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="360" y="260" width="80" height="40" as="geometry" />
        </mxCell>

        <!-- FIFO indicators -->
        <mxCell id="fifo-lstf" value="&lt;b&gt;lstf_stream&lt;/b&gt;&lt;br&gt;d=160" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#eff6ff;strokeColor=#1971c2;fontSize=9;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="220" y="340" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="fifo-passthrough" value="&lt;b&gt;passthrough_stream&lt;/b&gt;&lt;br&gt;d=680" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#eff6ff;strokeColor=#1971c2;fontSize=9;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="200" y="410" width="130" height="30" as="geometry" />
        </mxCell>

        <!-- ==================== COMPUTE Stage ==================== -->
        <mxCell id="stage-compute-border" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8fafc;strokeColor=#94a3b8;dashed=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="500" y="70" width="370" height="300" as="geometry" />
        </mxCell>
        <mxCell id="stage-compute-label" value="&lt;b&gt;COMPUTE&lt;/b&gt; (II=1)" style="text;html=1;align=center;verticalAlign=top;fontSize=12;fontColor=#94a3b8;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="630" y="75" width="120" height="20" as="geometry" />
        </mxCell>

        <!-- use[] local array -->
        <mxCell id="compute-use" value="&lt;b&gt;use[USE_LEN]&lt;/b&gt;&lt;br&gt;L-STF samples&lt;br&gt;&lt;font style='font-size:9px;color:#6b7280;'&gt;local array for&lt;br&gt;autocorrelation&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#e0e7ff;strokeColor=#4f46e5;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="520" y="110" width="120" height="70" as="geometry" />
        </mxCell>

        <!-- Autocorrelation -->
        <mxCell id="compute-autocorr" value="&lt;b&gt;Autocorrelation&lt;/b&gt;&lt;br&gt;16-tap shift register&lt;br&gt;&lt;font style='font-size:9px;color:#6b7280;'&gt;complex conj multiply&lt;br&gt;sliding window sum&lt;br&gt;PARTITION complete (16 FFs)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="660" y="110" width="150" height="80" as="geometry" />
        </mxCell>

        <!-- DSP annotation for autocorr -->
        <mxCell id="dsp-autocorr" value="&lt;b&gt;DSP: 10 MUL&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px;color:#6b7280;'&gt;complex conj*delayed&lt;br&gt;+ energy products&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="520" y="200" width="120" height="55" as="geometry" />
        </mxCell>

        <!-- CORDIC atan2 -->
        <mxCell id="compute-cordic" value="&lt;b&gt;CORDIC atan2&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px;color:#6b7280;'&gt;16-bit, 16 iterations&lt;br&gt;angle -&gt; CFO frequency&lt;br&gt;scaling to rad/sample&lt;br&gt;~200 LUT, 0 DSP&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fef3c7;strokeColor=#d97706;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="660" y="210" width="150" height="80" as="geometry" />
        </mxCell>

        <!-- FIFO: cfo_stream -->
        <mxCell id="fifo-cfo" value="&lt;b&gt;cfo_stream&lt;/b&gt;&lt;br&gt;d=4" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#eff6ff;strokeColor=#1971c2;fontSize=9;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="660" y="310" width="80" height="30" as="geometry" />
        </mxCell>

        <!-- ==================== APPLY Stage ==================== -->
        <mxCell id="stage-apply-border" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8fafc;strokeColor=#94a3b8;dashed=1;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="910" y="70" width="420" height="430" as="geometry" />
        </mxCell>
        <mxCell id="stage-apply-label" value="&lt;b&gt;APPLY&lt;/b&gt; (II=1)" style="text;html=1;align=center;verticalAlign=top;fontSize=12;fontColor=#94a3b8;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="1070" y="75" width="100" height="20" as="geometry" />
        </mxCell>

        <!-- NCO LUT ROM -->
        <mxCell id="apply-nco-sin" value="&lt;b&gt;sin_lut[1024]&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px;color:#6b7280;'&gt;ROM_2P (dual-port)&lt;br&gt;quarter-wave symmetry&lt;br&gt;~1 RAMB18&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#e0e7ff;strokeColor=#4f46e5;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="930" y="110" width="120" height="70" as="geometry" />
        </mxCell>

        <mxCell id="apply-nco-cos" value="&lt;b&gt;cos_lut[1024]&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px;color:#6b7280;'&gt;ROM_2P (dual-port)&lt;br&gt;quarter-wave symmetry&lt;br&gt;~1 RAMB18&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#e0e7ff;strokeColor=#4f46e5;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1070" y="110" width="120" height="70" as="geometry" />
        </mxCell>

        <!-- Phase accumulator -->
        <mxCell id="apply-phase-acc" value="&lt;b&gt;Phase Accumulator&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px;color:#6b7280;'&gt;phi += delta_phase&lt;br&gt;per-sample increment&lt;br&gt;linear interpolation&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99e9f2;strokeColor=#0c8599;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="990" y="210" width="140" height="60" as="geometry" />
        </mxCell>

        <!-- Phase acc feedback -->
        <mxCell id="fb-phase" value="phi" style="endArrow=block;endFill=1;html=1;strokeColor=#868e96;strokeWidth=1;dashed=1;dashPattern=2 4;fontSize=9;fontColor=#868e96;labelBackgroundColor=#FFFFFF;curved=1;" edge="1" source="apply-phase-acc" target="apply-phase-acc" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="970" y="250" />
              <mxPoint x="970" y="220" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Pipeline register pre-mul -->
        <mxCell id="preg-premul" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;" vertex="1" parent="1">
          <mxGeometry x="1150" y="210" width="8" height="60" as="geometry" />
        </mxCell>

        <!-- Complex rotation multiplier -->
        <mxCell id="apply-cmul" value="&lt;b&gt;Complex MUL&lt;/b&gt;&lt;br&gt;data * exp(-j*phi)&lt;br&gt;&lt;font style='font-size:9px;color:#6b7280;'&gt;I' = I*cos + Q*sin&lt;br&gt;Q' = Q*cos - I*sin&lt;br&gt;4 DSP48E1 (18x18)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1180" y="200" width="130" height="90" as="geometry" />
        </mxCell>

        <!-- Pipeline register post-mul -->
        <mxCell id="preg-postmul" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;" vertex="1" parent="1">
          <mxGeometry x="1180" y="310" width="8" height="50" as="geometry" />
        </mxCell>

        <!-- Truncation post-apply -->
        <mxCell id="apply-trunc" value="&lt;b&gt;TRUNC&lt;/b&gt;&lt;br&gt;-&gt; data_t" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1210" y="310" width="80" height="50" as="geometry" />
        </mxCell>

        <!-- ==================== Data Flow Edges ==================== -->

        <!-- External inputs -->
        <mxCell id="edge-datain-fsm" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="io-data-in" target="extract-fsm" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-ctrl-fsm" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;html=1;" edge="1" source="io-ctrl-in" target="extract-fsm" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- FSM -> circ_buf write -->
        <mxCell id="edge-fsm-buf" value="wr" style="endArrow=block;endFill=1;html=1;strokeColor=#4f46e5;strokeWidth=1;dashed=1;fontSize=9;fontColor=#4f46e5;labelBackgroundColor=#FFFFFF;edgeStyle=orthogonalEdgeStyle;rounded=1;" edge="1" source="extract-fsm" target="extract-circbuf" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- circ_buf -> lstf_stream -->
        <mxCell id="edge-buf-lstf" value="replay rd" style="endArrow=block;endFill=1;html=1;strokeColor=#4f46e5;strokeWidth=1;dashed=1;fontSize=9;fontColor=#4f46e5;labelBackgroundColor=#FFFFFF;edgeStyle=orthogonalEdgeStyle;rounded=1;" edge="1" source="extract-circbuf" target="fifo-lstf" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="380" y="220" />
              <mxPoint x="380" y="310" />
              <mxPoint x="270" y="310" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- circ_buf -> passthrough_stream -->
        <mxCell id="edge-buf-pass" style="endArrow=block;endFill=1;html=1;strokeColor=#4f46e5;strokeWidth=1;dashed=1;fontSize=9;fontColor=#4f46e5;labelBackgroundColor=#FFFFFF;edgeStyle=orthogonalEdgeStyle;rounded=1;" edge="1" source="extract-circbuf" target="fifo-passthrough" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="420" y="180" />
              <mxPoint x="420" y="380" />
              <mxPoint x="265" y="380" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- lstf_stream -> COMPUTE -->
        <mxCell id="edge-lstf-use" value="lstf_stream (160)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fifo-lstf" target="compute-use" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="460" y="355" />
              <mxPoint x="460" y="145" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- passthrough_stream -> APPLY complex MUL -->
        <mxCell id="edge-pass-cmul" value="passthrough (640, d=680)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fifo-passthrough" target="apply-cmul" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="265" y="470" />
              <mxPoint x="900" y="470" />
              <mxPoint x="900" y="400" />
              <mxPoint x="1160" y="400" />
              <mxPoint x="1160" y="280" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- use[] -> autocorrelation -->
        <mxCell id="edge-use-autocorr" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="compute-use" target="compute-autocorr" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- autocorr -> CORDIC -->
        <mxCell id="edge-autocorr-cordic" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="compute-autocorr" target="compute-cordic" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- CORDIC -> cfo_stream -->
        <mxCell id="edge-cordic-cfo" value="freq_t" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="compute-cordic" target="fifo-cfo" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- cfo_stream -> phase accumulator -->
        <mxCell id="edge-cfo-phaseacc" value="cfo_stream (d=4)" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fifo-cfo" target="apply-phase-acc" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="700" y="360" />
              <mxPoint x="880" y="360" />
              <mxPoint x="880" y="240" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- NCO LUTs -> phase acc -->
        <mxCell id="edge-sin-phaseacc" value="sin" style="endArrow=block;endFill=1;html=1;strokeColor=#4f46e5;strokeWidth=1;dashed=1;fontSize=9;fontColor=#4f46e5;labelBackgroundColor=#FFFFFF;edgeStyle=orthogonalEdgeStyle;rounded=1;" edge="1" source="apply-nco-sin" target="apply-phase-acc" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-cos-phaseacc" value="cos" style="endArrow=block;endFill=1;html=1;strokeColor=#4f46e5;strokeWidth=1;dashed=1;fontSize=9;fontColor=#4f46e5;labelBackgroundColor=#FFFFFF;edgeStyle=orthogonalEdgeStyle;rounded=1;" edge="1" source="apply-nco-cos" target="apply-phase-acc" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Phase acc -> pipeline reg -> complex MUL -->
        <mxCell id="edge-phaseacc-preg" value="sin/cos" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="apply-phase-acc" target="preg-premul" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-preg-cmul" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="preg-premul" target="apply-cmul" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Complex MUL -> trunc -> output -->
        <mxCell id="edge-cmul-trunc" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="apply-cmul" target="apply-trunc" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-trunc-dataout" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="apply-trunc" target="io-data-out" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- CORDIC -> freq output -->
        <mxCell id="edge-cordic-freqout" value="coarseFreqOff" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="compute-cordic" target="io-freq-out" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="840" y="250" />
              <mxPoint x="840" y="60" />
              <mxPoint x="1415" y="60" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- ==================== Resource Summary ==================== -->
        <mxCell id="resource-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f9fafb;strokeColor=#d1d5db;" vertex="1" parent="1">
          <mxGeometry x="20" y="530" width="350" height="130" as="geometry" />
        </mxCell>
        <mxCell id="resource-title" value="&lt;b&gt;Resource Summary (CSYNTH)&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=top;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="535" width="250" height="20" as="geometry" />
        </mxCell>
        <mxCell id="res-dsp" value="DSP48E1: 18 (10 autocorr + 4 complex rotation + 4 other)" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="35" y="560" width="330" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-bram" value="BRAM: 12 RAMB18-eq (~4 circ_buf + 2 NCO + 6 FIFO/misc)" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="35" y="580" width="330" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-lut" value="LUT: 3001 (CORDIC ~200, FSM ~100, autocorr + rotation)" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="35" y="600" width="330" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-ff" value="FF: 1903 (shift regs, accum, pipeline regs, counters)" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="35" y="620" width="330" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-ii" value="II: 1 (all stages fully pipelined)" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="35" y="640" width="330" height="18" as="geometry" />
        </mxCell>

        <!-- ==================== Legend ==================== -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8f9fa;strokeColor=#495057;" vertex="1" parent="1">
          <mxGeometry x="410" y="530" width="280" height="130" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="&lt;b&gt;Legend&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=top;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="420" y="535" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="leg-dsp" value="DSP" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="420" y="560" width="45" height="18" as="geometry" />
        </mxCell>
        <mxCell id="leg-dsp-text" value="Compute / DSP48E1" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="475" y="558" width="150" height="18" as="geometry" />
        </mxCell>
        <mxCell id="leg-mem" value="MEM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e7ff;strokeColor=#4f46e5;dashed=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="420" y="583" width="45" height="18" as="geometry" />
        </mxCell>
        <mxCell id="leg-mem-text" value="BRAM / ROM (dashed)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="475" y="581" width="150" height="18" as="geometry" />
        </mxCell>
        <mxCell id="leg-fsm" value="FSM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3c7;strokeColor=#d97706;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="420" y="606" width="45" height="18" as="geometry" />
        </mxCell>
        <mxCell id="leg-fsm-text" value="FSM / Control / CORDIC" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="475" y="604" width="150" height="18" as="geometry" />
        </mxCell>
        <mxCell id="leg-acc" value="ACC" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99e9f2;strokeColor=#0c8599;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="420" y="629" width="45" height="18" as="geometry" />
        </mxCell>
        <mxCell id="leg-acc-text" value="Accumulator / Feedback" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="475" y="627" width="150" height="18" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
