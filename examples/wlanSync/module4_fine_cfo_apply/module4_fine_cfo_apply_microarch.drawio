<mxfile host="app.diagrams.net" type="device">
  <diagram name="M4 Micro-Architecture" id="m4-microarch">
    <mxGraphModel dx="1400" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="&lt;b&gt;module4_fine_cfo_apply - RTL Micro-Architecture&lt;/b&gt;&lt;br&gt;3-Stage DATAFLOW: EXTRACT(FSM+circ_buf) -&gt; COMPUTE(autocorr+CORDIC) -&gt; APPLY(NCO+rotation)" style="text;html=1;align=left;verticalAlign=top;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="20" y="10" width="700" height="40" as="geometry" />
        </mxCell>

        <!-- I/O Ports -->
        <mxCell id="io-data-in" value="&lt;b&gt;data_in&lt;/b&gt;&lt;br&gt;complex_t" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#059669;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="20" y="340" width="90" height="50" as="geometry" />
        </mxCell>

        <mxCell id="io-startOffset-in" value="&lt;b&gt;startOffset_in&lt;/b&gt;&lt;br&gt;index_t (async&lt;br&gt;~cycle 155)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#fce7f3;strokeColor=#db2777;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="20" y="170" width="110" height="60" as="geometry" />
        </mxCell>

        <mxCell id="io-fineOffset-in" value="&lt;b&gt;fineOffset_in&lt;/b&gt;&lt;br&gt;index_t (async&lt;br&gt;~cycle 6600)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#fce7f3;strokeColor=#db2777;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="20" y="250" width="110" height="60" as="geometry" />
        </mxCell>

        <mxCell id="io-data-out" value="&lt;b&gt;data_out&lt;/b&gt;&lt;br&gt;complex_t" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#059669;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1430" y="400" width="90" height="50" as="geometry" />
        </mxCell>

        <mxCell id="io-freq-out" value="&lt;b&gt;fineCfoFreq_out&lt;/b&gt;&lt;br&gt;freq_t" style="ellipse;whiteSpace=wrap;html=1;fillColor=#fce7f3;strokeColor=#db2777;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="1430" y="250" width="110" height="50" as="geometry" />
        </mxCell>

        <!-- ===================== EXTRACT STAGE ===================== -->
        <mxCell id="df-extract" value="" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#f8fafc;strokeColor=#94a3b8;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="160" y="70" width="380" height="640" as="geometry" />
        </mxCell>
        <mxCell id="df-extract-label" value="&lt;b&gt;EXTRACT&lt;/b&gt;&lt;br&gt;extract_lltf, II=1" style="text;html=1;align=center;verticalAlign=top;fontSize=11;fontColor=#94a3b8;" vertex="1" parent="1">
          <mxGeometry x="270" y="75" width="160" height="30" as="geometry" />
        </mxCell>

        <!-- FSM Controller -->
        <mxCell id="fsm" value="&lt;b&gt;FSM Controller&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;5 states:&lt;br&gt;WAIT_CTRL&lt;br&gt;WAIT_DATA_READY&lt;br&gt;EXTRACT_LLTF&lt;br&gt;PASSTHROUGH&lt;br&gt;DONE&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3c7;strokeColor=#d97706;fontSize=10;verticalAlign=top;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="190" y="120" width="140" height="140" as="geometry" />
        </mxCell>

        <!-- Circular Buffer -->
        <mxCell id="circ-buf" value="&lt;b&gt;circ_buf[8192]&lt;/b&gt;&lt;br&gt;complex_t x 8192&lt;br&gt;&lt;font color='#6b7280' style='font-size:9px'&gt;26 BRAM18&lt;br&gt;Largest buffer in system&lt;br&gt;write_idx &amp;amp; 0x1FFF&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#e0e7ff;strokeColor=#4f46e5;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="190" y="320" width="160" height="110" as="geometry" />
        </mxCell>

        <!-- Pipeline Reg: post-extract -->
        <mxCell id="preg-extract" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;" vertex="1" parent="1">
          <mxGeometry x="395" y="120" width="8" height="500" as="geometry" />
        </mxCell>

        <!-- FIFO indicators in EXTRACT -->
        <mxCell id="fifo-lltf" value="&lt;b&gt;lltf_stream&lt;/b&gt;&lt;br&gt;d=168" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#eff6ff;strokeColor=#1971c2;fontSize=9;fontStyle=0;" vertex="1" parent="1">
          <mxGeometry x="420" y="170" width="90" height="35" as="geometry" />
        </mxCell>

        <mxCell id="fifo-pass" value="&lt;b&gt;passthrough_stream&lt;/b&gt;&lt;br&gt;d=2048" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#eff6ff;strokeColor=#1971c2;fontSize=9;fontStyle=0;" vertex="1" parent="1">
          <mxGeometry x="420" y="420" width="110" height="35" as="geometry" />
        </mxCell>

        <mxCell id="fifo-offset" value="&lt;b&gt;offset_stream&lt;/b&gt;&lt;br&gt;d=4" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#eff6ff;strokeColor=#e03131;fontSize=9;fontStyle=0;" vertex="1" parent="1">
          <mxGeometry x="420" y="560" width="90" height="35" as="geometry" />
        </mxCell>

        <!-- ===================== COMPUTE STAGE ===================== -->
        <mxCell id="df-compute" value="" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#f8fafc;strokeColor=#94a3b8;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="570" y="70" width="300" height="340" as="geometry" />
        </mxCell>
        <mxCell id="df-compute-label" value="&lt;b&gt;COMPUTE&lt;/b&gt;&lt;br&gt;compute_fine_cfo, II=1" style="text;html=1;align=center;verticalAlign=top;fontSize=11;fontColor=#94a3b8;" vertex="1" parent="1">
          <mxGeometry x="640" y="75" width="160" height="30" as="geometry" />
        </mxCell>

        <!-- Autocorrelation -->
        <mxCell id="autocorr" value="&lt;b&gt;Autocorrelation&lt;/b&gt;&lt;br&gt;160 L-LTF samples&lt;br&gt;&lt;font color='#6b7280' style='font-size:9px'&gt;Complex conj product&lt;br&gt;+ accumulation&lt;br&gt;~8 DSP48E1&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="600" y="130" width="160" height="90" as="geometry" />
        </mxCell>

        <!-- CORDIC atan2 -->
        <mxCell id="cordic" value="&lt;b&gt;CORDIC atan2&lt;/b&gt;&lt;br&gt;16-bit, 16 iterations&lt;br&gt;&lt;font color='#6b7280' style='font-size:9px'&gt;No DSP, ~200 LUT&lt;br&gt;CFO angle extraction&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fef3c7;strokeColor=#d97706;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="610" y="260" width="160" height="80" as="geometry" />
        </mxCell>

        <!-- CFO Scaling -->
        <mxCell id="cfo-scale" value="&lt;b&gt;CFO Scale&lt;/b&gt;&lt;br&gt;angle -&gt; freq_t&lt;br&gt;&lt;font color='#6b7280' style='font-size:9px'&gt;1 DSP (multiply)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="790" y="270" width="60" height="60" as="geometry" />
        </mxCell>

        <!-- Pipeline Reg: post-compute -->
        <mxCell id="preg-compute" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;" vertex="1" parent="1">
          <mxGeometry x="890" y="130" width="8" height="220" as="geometry" />
        </mxCell>

        <!-- FIFO: cfo_stream -->
        <mxCell id="fifo-cfo" value="&lt;b&gt;cfo_stream&lt;/b&gt;&lt;br&gt;d=4" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#eff6ff;strokeColor=#e03131;fontSize=9;fontStyle=0;" vertex="1" parent="1">
          <mxGeometry x="910" y="285" width="80" height="35" as="geometry" />
        </mxCell>

        <!-- ===================== APPLY STAGE ===================== -->
        <mxCell id="df-apply" value="" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#f8fafc;strokeColor=#94a3b8;strokeWidth=2;" vertex="1" parent="1">
          <mxGeometry x="1020" y="70" width="370" height="640" as="geometry" />
        </mxCell>
        <mxCell id="df-apply-label" value="&lt;b&gt;APPLY&lt;/b&gt;&lt;br&gt;apply_correction, II=1" style="text;html=1;align=center;verticalAlign=top;fontSize=11;fontColor=#94a3b8;" vertex="1" parent="1">
          <mxGeometry x="1120" y="75" width="160" height="30" as="geometry" />
        </mxCell>

        <!-- NCO LUT -->
        <mxCell id="nco-lut" value="&lt;b&gt;NCO LUT[1024]&lt;/b&gt;&lt;br&gt;sin/cos ROM_2P&lt;br&gt;&lt;font color='#6b7280' style='font-size:9px'&gt;Quarter-wave symmetry&lt;br&gt;1 RAMB18 dual-port&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#e0e7ff;strokeColor=#4f46e5;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1050" y="130" width="150" height="80" as="geometry" />
        </mxCell>

        <!-- Phase Accumulator -->
        <mxCell id="phase-acc" value="&lt;b&gt;Phase Accumulator&lt;/b&gt;&lt;br&gt;phi += delta_phase&lt;br&gt;&lt;font color='#6b7280' style='font-size:9px'&gt;32-bit accumulator&lt;br&gt;1 DSP feedback&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#99e9f2;strokeColor=#0c8599;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1050" y="260" width="150" height="70" as="geometry" />
        </mxCell>

        <!-- Linear Interpolation -->
        <mxCell id="interp" value="&lt;b&gt;Linear Interp&lt;/b&gt;&lt;br&gt;&lt;font color='#6b7280' style='font-size:9px'&gt;2 DSP (I/Q interp)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1230" y="150" width="120" height="50" as="geometry" />
        </mxCell>

        <!-- Pipeline Reg: post-NCO -->
        <mxCell id="preg-nco" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;" vertex="1" parent="1">
          <mxGeometry x="1210" y="250" width="8" height="90" as="geometry" />
        </mxCell>

        <!-- Complex Rotation Multiplier -->
        <mxCell id="cmul" value="&lt;b&gt;Complex Rotation&lt;/b&gt;&lt;br&gt;data * exp(-j*phi)&lt;br&gt;&lt;font color='#6b7280' style='font-size:9px'&gt;4 DSP48E1&lt;br&gt;(a+jb)(c+jd)&lt;br&gt;= (ac-bd) + j(ad+bc)&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1230" y="390" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- Pipeline Reg: post-rotation -->
        <mxCell id="preg-rot" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;" vertex="1" parent="1">
          <mxGeometry x="1400" y="390" width="8" height="100" as="geometry" />
        </mxCell>

        <!-- Phase acc feedback -->
        <mxCell id="edge-phase-fb" value="phi" style="endArrow=block;endFill=1;html=1;strokeColor=#868e96;strokeWidth=1;dashed=1;dashPattern=2 4;fontSize=9;fontColor=#868e96;labelBackgroundColor=#FFFFFF;curved=1;" edge="1" source="phase-acc" target="phase-acc" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1030" y="295" />
              <mxPoint x="1030" y="270" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- ===================== EDGES ===================== -->

        <!-- External I/O -> EXTRACT -->
        <mxCell id="edge-datain-fsm" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="io-data-in" target="fsm" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="140" y="365" />
              <mxPoint x="140" y="190" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="edge-startoff-fsm" value="startOffset" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="io-startOffset-in" target="fsm" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-fineoff-fsm" value="fineOffset" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="io-fineOffset-in" target="fsm" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- FSM -> circ_buf (memory write) -->
        <mxCell id="edge-fsm-circ" value="wr" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#4f46e5;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#4f46e5;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fsm" target="circ-buf" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- circ_buf -> preg-extract (read path) -->
        <mxCell id="edge-circ-preg" value="rd" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#4f46e5;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#4f46e5;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="circ-buf" target="preg-extract" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- preg-extract -> FIFOs -->
        <mxCell id="edge-preg-lltf" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="preg-extract" target="fifo-lltf" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-preg-pass" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="preg-extract" target="fifo-pass" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-preg-offset" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;html=1;" edge="1" source="preg-extract" target="fifo-offset" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- lltf FIFO -> autocorr -->
        <mxCell id="edge-lltf-autocorr" value="160" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fifo-lltf" target="autocorr" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- autocorr -> cordic -->
        <mxCell id="edge-autocorr-cordic" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="autocorr" target="cordic" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- cordic -> cfo-scale -->
        <mxCell id="edge-cordic-scale" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="cordic" target="cfo-scale" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- cfo-scale -> preg-compute -->
        <mxCell id="edge-scale-preg" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="cfo-scale" target="preg-compute" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- preg-compute -> cfo FIFO -->
        <mxCell id="edge-preg-cfo" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;html=1;" edge="1" source="preg-compute" target="fifo-cfo" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- cfo FIFO -> phase accumulator -->
        <mxCell id="edge-cfo-phase" value="delta_phase" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fifo-cfo" target="phase-acc" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- phase acc -> NCO LUT -->
        <mxCell id="edge-phase-nco" value="index" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=1;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="phase-acc" target="nco-lut" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1125" y="250" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- NCO -> interp -->
        <mxCell id="edge-nco-interp" value="sin/cos" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#4f46e5;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#4f46e5;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="nco-lut" target="interp" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- interp -> preg-nco -->
        <mxCell id="edge-interp-preg" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="interp" target="preg-nco" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1214" y="175" />
              <mxPoint x="1214" y="290" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- preg-nco -> cmul -->
        <mxCell id="edge-preg-cmul" value="sin/cos" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="preg-nco" target="cmul" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- passthrough FIFO -> cmul -->
        <mxCell id="edge-pass-cmul" value="data" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fifo-pass" target="cmul" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="475" y="500" />
              <mxPoint x="1000" y="500" />
              <mxPoint x="1000" y="440" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- offset FIFO -> cmul (for timing alignment) -->
        <mxCell id="edge-offset-cmul" value="offset" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fifo-offset" target="cmul" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="465" y="640" />
              <mxPoint x="1000" y="640" />
              <mxPoint x="1000" y="470" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- cmul -> preg-rot -> data_out -->
        <mxCell id="edge-cmul-preg" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="cmul" target="preg-rot" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-preg-out" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="preg-rot" target="io-data-out" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- cordic -> freq_out (via compute stage bypass) -->
        <mxCell id="edge-cordic-freq" value="fineCfoFreq" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="cfo-scale" target="io-freq-out" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="820" y="370" />
              <mxPoint x="820" y="740" />
              <mxPoint x="1500" y="740" />
              <mxPoint x="1500" y="275" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- ===================== RESOURCE SUMMARY ===================== -->
        <mxCell id="resource-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f9fafb;strokeColor=#d1d5db;" vertex="1" parent="1">
          <mxGeometry x="20" y="800" width="400" height="170" as="geometry" />
        </mxCell>
        <mxCell id="resource-title" value="&lt;b&gt;Resource Summary (CSYNTH)&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=top;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="30" y="805" width="250" height="20" as="geometry" />
        </mxCell>
        <mxCell id="res-dsp" value="DSP48E1: 18 (autocorr: ~8, scale: 1, phase_acc: 1, interp: 2, cmul: 4, other: 2)" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="35" y="830" width="370" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-bram" value="BRAM: 26 (circ_buf[8192]: ~26 BRAM18, NCO LUT: 1 RAMB18)" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="35" y="850" width="370" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-lut" value="LUT: 2001 (CORDIC: ~200, FSM: ~300, routing: ~1500)" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="35" y="870" width="370" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-ff" value="FF: 1729" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="35" y="890" width="370" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-bottleneck" value="&lt;font color='#e03131'&gt;&lt;b&gt;Bottleneck:&lt;/b&gt; circ_buf[8192] = 26 BRAM, largest single buffer in system&lt;/font&gt;" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="35" y="915" width="370" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-ii" value="II: 1 (all stages fully pipelined)" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="35" y="940" width="370" height="18" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f9fafb;strokeColor=#d1d5db;" vertex="1" parent="1">
          <mxGeometry x="470" y="800" width="340" height="170" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="&lt;b&gt;Legend&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=top;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="480" y="805" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-dsp-box" value="DSP" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="480" y="830" width="50" height="18" as="geometry" />
        </mxCell>
        <mxCell id="legend-dsp-label" value="Compute / DSP48E1" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="540" y="828" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-mem-box" value="MEM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e0e7ff;strokeColor=#4f46e5;dashed=1;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="480" y="852" width="50" height="18" as="geometry" />
        </mxCell>
        <mxCell id="legend-mem-label" value="BRAM / NCO LUT (dashed)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="540" y="850" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-fsm-box" value="FSM" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fef3c7;strokeColor=#d97706;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="480" y="874" width="50" height="18" as="geometry" />
        </mxCell>
        <mxCell id="legend-fsm-label" value="FSM / CORDIC (control)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="540" y="872" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-acc-box" value="ACC" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#99e9f2;strokeColor=#0c8599;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="480" y="896" width="50" height="18" as="geometry" />
        </mxCell>
        <mxCell id="legend-acc-label" value="Accumulator (feedback)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="540" y="894" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-preg-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;" vertex="1" parent="1">
          <mxGeometry x="490" y="918" width="8" height="18" as="geometry" />
        </mxCell>
        <mxCell id="legend-preg-label" value="Pipeline register" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="540" y="916" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-fifo-box" value="d=N" style="rounded=1;whiteSpace=wrap;html=1;dashed=1;fillColor=#eff6ff;strokeColor=#1971c2;fontSize=9;fontStyle=2;" vertex="1" parent="1">
          <mxGeometry x="480" y="940" width="50" height="18" as="geometry" />
        </mxCell>
        <mxCell id="legend-fifo-label" value="Internal FIFO stream" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="540" y="938" width="180" height="20" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
