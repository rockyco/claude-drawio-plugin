<mxfile host="app.diagrams.net" type="device">
  <diagram name="M3 Architecture" id="m3-arch">
    <mxGraphModel dx="1400" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="900">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="title" value="&lt;b&gt;module3_fine_sync - Architecture&lt;/b&gt;&lt;br&gt;Karatsuba 3-FIR L-LTF Cross-Correlation, 160 taps, SP=16" style="text;html=1;align=left;verticalAlign=top;fontSize=13;" vertex="1" parent="1">
          <mxGeometry x="20" y="10" width="520" height="40" as="geometry" />
        </mxCell>

        <!-- Input Port -->
        <mxCell id="io-data-in" value="&lt;b&gt;data_in&lt;/b&gt;&lt;br&gt;complex_t&lt;br&gt;640 samples" style="ellipse;whiteSpace=wrap;html=1;fillColor=#d1fae5;strokeColor=#059669;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="40" y="250" width="110" height="70" as="geometry" />
        </mxCell>

        <!-- Module Box -->
        <mxCell id="m3-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#a5d8ff;strokeColor=#1971c2;fontSize=11;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="220" y="100" width="900" height="470" as="geometry" />
        </mxCell>
        <mxCell id="m3-label" value="&lt;b&gt;module3_fine_sync&lt;/b&gt;&lt;br&gt;#pragma HLS DATAFLOW" style="text;html=1;align=left;verticalAlign=top;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="240" y="105" width="300" height="35" as="geometry" />
        </mxCell>

        <!-- Splitter -->
        <mxCell id="split" value="&lt;b&gt;SPLIT&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:9px'&gt;I, Q, I+Q&lt;br&gt;extraction&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e9ecef;strokeColor=#868e96;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="280" y="220" width="100" height="70" as="geometry" />
        </mxCell>

        <!-- 3x FIR IP Blocks -->
        <mxCell id="fir-p1" value="&lt;b&gt;hls::FIR P1&lt;/b&gt;&lt;br&gt;Re * Ic&lt;br&gt;&lt;font color='#6b7280' style='font-size:9px'&gt;160 taps, SP=16&lt;br&gt;coeffs_re.inc&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fef9c3;strokeColor=#ca8a04;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="480" y="150" width="180" height="70" as="geometry" />
        </mxCell>

        <mxCell id="fir-p2" value="&lt;b&gt;hls::FIR P2&lt;/b&gt;&lt;br&gt;Im * (-Qc)&lt;br&gt;&lt;font color='#6b7280' style='font-size:9px'&gt;160 taps, SP=16&lt;br&gt;coeffs_im.inc&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fef9c3;strokeColor=#ca8a04;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="480" y="250" width="180" height="70" as="geometry" />
        </mxCell>

        <mxCell id="fir-p3" value="&lt;b&gt;hls::FIR P3&lt;/b&gt;&lt;br&gt;(I+Q) * (Ic-Qc)&lt;br&gt;&lt;font color='#6b7280' style='font-size:9px'&gt;160 taps, SP=16&lt;br&gt;coeffs_sum.inc&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fef9c3;strokeColor=#ca8a04;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="480" y="350" width="180" height="70" as="geometry" />
        </mxCell>

        <!-- Karatsuba Combine -->
        <mxCell id="combine" value="&lt;b&gt;Karatsuba Combine&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:10px'&gt;Re = P1 + P2&lt;br&gt;Im = P3 - P1 + P2&lt;/font&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="740" y="200" width="150" height="80" as="geometry" />
        </mxCell>

        <!-- Magnitude Squared -->
        <mxCell id="magsq" value="&lt;b&gt;|corr|^2&lt;/b&gt;&lt;br&gt;Re^2 + Im^2" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dbeafe;strokeColor=#1971c2;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="740" y="320" width="150" height="60" as="geometry" />
        </mxCell>

        <!-- Peak Detector -->
        <mxCell id="peak" value="&lt;b&gt;Peak Detect&lt;/b&gt;&lt;br&gt;&lt;font style='font-size:10px'&gt;Track max |corr|^2&lt;br&gt;+ CSD refinement&lt;/font&gt;" style="shape=rhombus;whiteSpace=wrap;html=1;fillColor=#ffc9c9;strokeColor=#e03131;fontSize=10;fontStyle=0;" vertex="1" parent="1">
          <mxGeometry x="940" y="240" width="140" height="100" as="geometry" />
        </mxCell>

        <!-- Output Port -->
        <mxCell id="io-offset-out" value="&lt;b&gt;fineOffset_out&lt;/b&gt;&lt;br&gt;index_t&lt;br&gt;(scalar)" style="ellipse;whiteSpace=wrap;html=1;fillColor=#fce7f3;strokeColor=#db2777;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1180" y="255" width="120" height="60" as="geometry" />
        </mxCell>

        <!-- Data edges: input -> split -->
        <mxCell id="edge-in-split" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="io-data-in" target="split" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Split -> 3 FIRs -->
        <mxCell id="edge-split-fir1" value="re_stream" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="split" target="fir-p1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="420" y="180" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="edge-split-fir2" value="im_stream" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="split" target="fir-p2" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-split-fir3" value="sum_stream" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="split" target="fir-p3" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="420" y="385" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- FIRs -> Combine -->
        <mxCell id="edge-fir1-combine" value="P1" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fir-p1" target="combine" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-fir2-combine" value="P2" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fir-p2" target="combine" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-fir3-combine" value="P3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;fontSize=9;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="fir-p3" target="combine" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="700" y="385" />
              <mxPoint x="700" y="260" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Combine -> MagSq -->
        <mxCell id="edge-combine-magsq" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="combine" target="magsq" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- MagSq -> Peak -->
        <mxCell id="edge-magsq-peak" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#1971c2;strokeWidth=2;endArrow=block;endFill=1;html=1;" edge="1" source="magsq" target="peak" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Peak -> Output -->
        <mxCell id="edge-peak-out" value="fineOffset" style="edgeStyle=orthogonalEdgeStyle;rounded=1;strokeColor=#e03131;strokeWidth=1;dashed=1;endArrow=block;endFill=1;fontSize=9;fontColor=#e03131;labelBackgroundColor=#FFFFFF;html=1;" edge="1" source="peak" target="io-offset-out" parent="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Resource Summary -->
        <mxCell id="resource-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f9fafb;strokeColor=#d1d5db;" vertex="1" parent="1">
          <mxGeometry x="240" y="610" width="360" height="130" as="geometry" />
        </mxCell>
        <mxCell id="resource-title" value="&lt;b&gt;Resource Summary (CSYNTH)&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=top;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="250" y="615" width="250" height="20" as="geometry" />
        </mxCell>
        <mxCell id="res-dsp" value="DSP48E1: 120 (3x FIR IP at SP=8)" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="255" y="640" width="300" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-bram" value="BRAM: 6" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="255" y="660" width="300" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-lut" value="LUT: 2487" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="255" y="680" width="300" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-ff" value="FF: 2193" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="255" y="700" width="300" height="18" as="geometry" />
        </mxCell>
        <mxCell id="res-pattern" value="Patterns: FP-CORR, FP-CORR-SP (Karatsuba 3-FIR)" style="text;html=1;align=left;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="255" y="720" width="340" height="18" as="geometry" />
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend-box" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f9fafb;strokeColor=#d1d5db;" vertex="1" parent="1">
          <mxGeometry x="660" y="610" width="280" height="130" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="&lt;b&gt;Legend&lt;/b&gt;" style="text;html=1;align=left;verticalAlign=top;fontSize=11;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="670" y="615" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-data-line" value="" style="endArrow=block;endFill=1;strokeColor=#1971c2;strokeWidth=2;html=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="670" y="650" as="sourcePoint" />
            <mxPoint x="720" y="650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-data-text" value="Data stream (hls::stream)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="730" y="640" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-ctrl-line" value="" style="endArrow=block;endFill=1;strokeColor=#e03131;strokeWidth=1;dashed=1;html=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="670" y="675" as="sourcePoint" />
            <mxPoint x="720" y="675" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="legend-ctrl-text" value="Control signal (scalar)" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="730" y="665" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-fir-box" value="FIR IP" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fef9c3;strokeColor=#ca8a04;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="670" y="690" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-fir-text" value="hls::FIR IP core" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="730" y="690" width="180" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-peak-box" value="&amp;gt; THR" style="shape=rhombus;whiteSpace=wrap;html=1;fillColor=#ffc9c9;strokeColor=#e03131;fontSize=8;" vertex="1" parent="1">
          <mxGeometry x="672" y="715" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-peak-text" value="Peak detect / comparator" style="text;html=1;align=left;fontSize=9;" vertex="1" parent="1">
          <mxGeometry x="730" y="715" width="180" height="20" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
